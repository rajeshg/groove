// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Account {
  id        String  @id @default(uuid())
  email     String  @unique
  firstName String?
  lastName  String?
  boards Board[]
  boardMemberships BoardMember[]
  receivedInvitations BoardInvitation[]
  assignees Assignee[]
  comments Comment[] @relation("CommentCreatedBy")
  createdItems Item[] @relation("ItemCreatedBy")

  Password Password?
}

model Password {
  id        String  @id @default(uuid())
  salt      String
  hash      String
  Account   Account @relation(fields: [accountId], references: [id])
  accountId String  @unique
}

model Board {
  id        Int      @id @default(autoincrement())
  name      String
  color     String   @default("#e0e0e0")
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  columns   Column[]
  items     Item[]
  members   BoardMember[]
  invitations BoardInvitation[]
  assignees Assignee[]
  Account   Account  @relation(fields: [accountId], references: [id])
  accountId String
}

model Column {
  id        String   @id @default(uuid())
  name      String
  color     String   @default("#94a3b8")
  order     Float    @default(0)
  isDefault Boolean  @default(false)
  isExpanded Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  items     Item[]
  Board     Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  boardId   Int
}

model Item {
    id        String   @id @default(uuid())
    title     String
    content   String?

    // we split the difference between the prev/next items. If an item is dropped
    // between 1.00 and 2.00 it will be 1.50. If dropped between 1.50 and 2.00 it
    // will be 1.75, etc.
    order     Float

    createdAt    DateTime @default(now())
    updatedAt    DateTime @default(now()) @updatedAt
    lastActiveAt DateTime @default(now())
    createdBy    String?
    createdByUser Account? @relation("ItemCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)

    Column   Column @relation(fields: [columnId], references: [id], onDelete: Cascade)
    columnId String

    Board   Board @relation(fields: [boardId], references: [id], onDelete: Cascade)
    boardId Int

    Assignee   Assignee? @relation(fields: [assigneeId], references: [id], onDelete: SetNull)
    assigneeId String?

    comments Comment[]
}

model Comment {
  id        String   @id @default(uuid())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  createdBy String?
  createdByUser Account? @relation("CommentCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)

  Item   Item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
  itemId String
}

model Assignee {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())

  Board   Board @relation(fields: [boardId], references: [id], onDelete: Cascade)
  boardId Int

  Account   Account? @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId    String?

  items     Item[]

  @@unique([name, boardId])
}

model BoardMember {
  id        String   @id @default(uuid())
  role      String   @default("editor")
  createdAt DateTime @default(now())

  Account   Account @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId String

  Board   Board @relation(fields: [boardId], references: [id], onDelete: Cascade)
  boardId Int

  @@unique([accountId, boardId])
}

model BoardInvitation {
  id        String   @id @default(uuid())
  email     String
  role      String   @default("editor")
  status    String   @default("pending")
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  Board   Board @relation(fields: [boardId], references: [id], onDelete: Cascade)
  boardId Int

  Account   Account @relation(fields: [invitedBy], references: [id])
  invitedBy String

  @@unique([email, boardId])
}